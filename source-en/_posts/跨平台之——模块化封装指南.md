---
title: 跨平台之——模块化封装指南
categories:
  - 开发
  - F-跨平台
  - 模块化
tags:
  - 模块化
abbrlink: 8a03b367
date: 2025-11-26 18:02:57
---
## 一 概述

```
本文介绍：
 - iOS 编译为.framework
 - Android 编译为.jar/.aar
```

<!--more-->

## 二 iOS 编译为 .framework

### 2.1  创建 Framework Target

```
-打开 Xcode 项目
-File → New → Target → Framework (iOS)
-填写名称（如 MySDK）
```

### 2.2 配置 Build Settings

|             设置项             |     推荐值      |           说明           |
| :----------------------------: | :-------------: | :----------------------: |
|          Mach-O Type           | Dynamic Library | 支持资源捆绑，运行时加载 |
| Build Active Architecture Only |  NO (Release)   |       打包所有架构       |
|         Architectures          |  arm64, x86_64  |    支持真机 + 模拟器     |
|         Define Module          |       YES       |    支持 @import MySDK    |
|    Enable Modules (C/Obj-C)    |       YES       |        模块化导入        |
|     Framework Search Paths     |    配置正确     |       框架依赖路径       |

建议：使用 **动态框架**，更灵活。

### 2.3 编译通用 Framework

```
# 编译真机版
xcodebuild -target MySDK \
  -configuration Release \
  -sdk iphoneos \
  ARCHS="arm64" \
  ONLY_ACTIVE_ARCH=NO \
  BUILD_DIR=build

# 编译模拟器版
xcodebuild -target MySDK \
  -configuration Release \
  -sdk iphonesimulator \
  ARCHS="x86_64 arm64" \
  ONLY_ACTIVE_ARCH=NO \
  BUILD_DIR=build

# 合并为通用 framework
lipo -create \
  build/Release-iphoneos/MySDK.framework/MySDK \
  build/Release-iphonesimulator/MySDK.framework/MySDK \
  -output MySDKUniversal

# 替换二进制
cp -R build/Release-iphoneos/MySDK.framework .
mv MySDKUniversal MySDK.framework/MySDK
```

### 2.4 输出结构

```
MySDK.framework/
├── MySDK              ← 通用二进制
├── Headers/           ← 公共头文件
├── Modules/           ← module.map
├── Info.plist
└── Resources/         ← storyboard、图片等
```

## 三 Android 编译为.jar/.aar

### 3.1 纯逻辑代码 → .jar

```
1、创建 Java Library Module
apply plugin: 'java-library'

dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])
}

sourceSets {
    main {
        java.srcDirs = ['src/main/java']
    }
}

2、编译生成 .jar
./gradlew :library:jar
# 输出路径：
library/build/libs/library.jar
```

### 3.2 含资源 → .aar

```
1、配置
apply plugin: 'com.android.library'

android {
    compileSdk 34
    defaultConfig {
        minSdk 21
        targetSdk 34
    }
}

dependencies {
    implementation 'androidx.appcompat:appcompat:1.6.1'
}

2、编译
./gradlew :library:assembleRelease
# 输出路径：
library/build/outputs/aar/library-release.aar
```

## 四 跨平台统一封装建议

|    平台    |    推荐封装格式    |                           说明                            |
| :--------: | :----------------: | :-------------------------------------------------------: |
|    iOS     | .framework（动态） |                   支持 Swift/OC + 资源                    |
|  Android   |        .aar        |                  包含 Java/Kotlin + 资源                  |
| 跨平台调用 |    提供统一接口    | Flutter / Unity / RN 等通过桥接调用（如 C API、JNI、FFI） |

## 五 常见问题

### 5.1 IOS

```
头文件不公开？ → Target → Build Phases → Headers → 拖到 Public
Swift 支持？ → Embedded Content Contains Swift Code = YES
Bitcode → 通常设为 NO（除非 App Store 要求）
```

### 5.2 Android

```
Proguard 规则 → .jar 不支持，改为 .aar + consumerProguardFiles
依赖冲突 → 使用 api / implementation 正确声明
```

## 六 自动化脚本示例(iOS 通用 Framework)

```
#!/bin/bash
FRAMEWORK_NAME="MySDK"

# 编译真机 + 模拟器
xcodebuild -target $FRAMEWORK_NAME -configuration Release -sdk iphoneos clean build
xcodebuild -target $FRAMEWORK_NAME -configuration Release -sdk iphonesimulator clean build

# 合并为通用二进制
lipo -create \
  build/Release-iphoneos/$FRAMEWORK_NAME.framework/$FRAMEWORK_NAME \
  build/Release-iphonesimulator/$FRAMEWORK_NAME.framework/$FRAMEWORK_NAME \
  -output $FRAMEWORK_NAME.framework/$FRAMEWORK_NAME

echo "Universal $FRAMEWORK_NAME.framework created!"
```

## 七 总结

|       目标       |                    操作 / 命令                     |
| :--------------: | :------------------------------------------------: |
| iOS → .framework | Xcode 创建 Framework → 编译真机+模拟器 → lipo 合并 |
|  Android → .jar  |            java-library → ./gradlew jar            |
|  Android → .aar  |  com.android.library → ./gradlew assembleRelease   |

核心原则
```
纯逻辑代码用 .jar / .framework，含资源和依赖建议用 .aar / 动态 .framework。
```

