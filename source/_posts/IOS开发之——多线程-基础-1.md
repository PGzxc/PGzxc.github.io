---
title: IOS开发之——多线程-基础(1)
categories:
  - 开发
  - D-移动开发
  - IOS
tags:
  - IOS
abbrlink: 7e2359ed
date: 2022-02-21 09:05:45
---
## 一 概述

* 进程和线程
* 多线程在IOS开发中的应用
* 耗时操作的执行

<!--more-->

## 二 进程和线程

### 2.1 什么是进程

* 进程是指在系统中<font color=red>正在运行</font>的一个应用程序
* 比如同时打开QQ、Xcode，系统就会分别启动2个进程
* 通过“活动监视器”可以查看Mac系统中所开启的进程

### 2.2 什么是线程

* 一个进程要想执行任务，<font color=red>必须</font>得有线程(<font color=red>每1个进程至少要有1条线程</font>)
* <font color=red>线程是进程的基本执行单元</font>，一个进程(程序)的所有任务都在线程中执行
* 比如使用酷狗播放音乐、使用迅雷下载电影，都需要在线程中执行

### 2.3 线程的串行

* 一个线程中任务的执行是<font color=red>串行</font>的
* 如果要在1个线程中执行多个任务，那么只能一个一个地按顺序执行这些任务
* 也就是说，在同一时间内，1个线程只能执行1个任务
* 比如在一个线程中下载3个文件(分别是文件A、文件B、文件C)，串行下载
* 因此，也可以认为<font color=red>线程是进程中的1条执行路径</font>

### 2.4 什么是多线程

* 一个进程中可以开启多条线程，每条线程可以<font color=red>并行(同时)</font>执行不同的任务
* 进程——>车间，线程——>车间工人
* 比如同时开启3条线程分别下载3个文件(分别是文件A、文件B、文件C)，文件并行下载

### 2.5 多线程的原理

* 同一时间，CPU只能处理1条线程，只有1条线程工作(执行)
* 多线程并发(同时)执行，其实是CPU快速地在多条线程之间<font color=red>调度</font>(切换)
* 如果CPU调度线程的时间足够快，就造成了多线程并发执行的假象
* 思考：如果多线程非常非常多，会发生什么情况？
  - CPU会在N多线程之间调度，CPU会累死，消耗大量的CPU资源
  - 每条线程被调度执行的频次会降低(线程的执行效率降低)

### 2.6 多线程的优缺点

####  多线程的有点

* 能适当提高程序的执行效率
* 能适当提高资源利用率(CPU、内存利用率)

#### 多线程的缺点

* 开启线程需要占用一定的内存空间(默认情况下，主线程占用1M，子线程占用512KB)，如果开启大量的线程，会占用大量的内存空间，降低程序的性能
* 线程越多，CPU在调度线程上的开销就越大
* 程序设计更加复杂：比如线程之间的通信、多线程的数据共享

## 三 多线程在IOS开发中的应用

### 3.1 什么是主线程

一个IOS程序运行后，默认会开启1条线程，称为“主线程”或“UI线程“

### 3.2 主线程的主要作用

* 显示、刷新UI界面
* 处理UI事件(比如点击事件、滚动事件、拖拽事件等)

### 3.3 主线程的使用注意

* 别讲比较耗时的操作放在主线程中
* 耗时操作会卡住主线程，严重影响UI的流程度，给用户一种“卡”的坏体验

## 四 耗时操作的执行(耗时操作在主线程)

### 4.1 代码(点击时输出Log文件)

```
-(void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event
{
    NSLog(@"当前线程未：%@",[NSThread currentThread]);
    for (int i=0;i<10000;i++) {
        NSLog(@"-----%d",i);
    }
}
```

### 4.2 现象

![][1]
### 4.3  过程说明
![][2]
### 4.4  应该执行的操作(将耗时操作放在子线程(后台线程、非主线程))
![][3]



[1]:https://cdn.jsdelivr.net/gh/PGzxc/CDN/blog-ios/ios-thread-main-dead.gif
[2]:https://cdn.jsdelivr.net/gh/PGzxc/CDN/blog-ios/ios-thread-main-dead-process.png
[3]:https://cdn.jsdelivr.net/gh/PGzxc/CDN/blog-ios/ios-thread-main-dead-deal.png
