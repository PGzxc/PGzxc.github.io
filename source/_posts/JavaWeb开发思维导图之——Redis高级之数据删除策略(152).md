---
title: JavaWeb开发思维导图之——Redis高级之数据删除策略(152)
categories:
  - 开发
  - G-后端开发
  - JavaWeb
tags:
  - JavaWeb
abbrlink: d58968f0
date: 2025-06-05 08:26:50
---
## 一 概述

* 定时删除
* 惰性删除
* 定期删除
* 删除策略对比

<!--more-->

## 二 定时删除

```
1-创建一个定时器，当key设置有过期时间，且过期时间到达时，由定时器任务立即执行对键的删除操作
2-优点: 节约内存，到时就删除，快速释放掉不必要的内存占用
3-缺点: CPU压力很大，无论cpu此时负载量多高，均占用cpu, 会影响redis服务器响应时间和指令吞吐量
4-总结: 用处理器性能换取存储空间(拿时间换空间)
```

## 三 惰性删除

```
1-数据达到过期时间，不做处理。等下次访问该数据时
2-优点: 节约cpu性能，发现必须删除的时候才删除
3-缺点: 内存压力很大，出现长期占用内存的数据
4-用存储空间换取处理器性能(拿时间换空间)
```

## 四 定期删除

### 4.1 模型

```
1-根据配置分为10个过期块
2-每个过期块存储一定量数据
3-到达过期时间时，current_db为1(第一个块)，执行检测删除
4-activeExpireCycle执行时间到，current_db+1继续
```

### 4.2 方案说明

```
1-Redis启动服务器初始化时，读取配置server.hz的值，默认为10
2-每秒钟执行server.hz次serverCron()->databasesCron()->activeExpireCycle()
3-activeExpireCycle()对每个expires[*]逐一进行检测，每次执行250ms/server.hz
4-如何检测
5-参数current_db用于记录activeExpireCycle()进入哪个expire[*]执行
6-如果activeExpireCycle()执行时间到期，下次从current_db继续向下执行
```

### 4.3 定期删除

```
1-周期性轮询redis库中的时效性数据，采用随机抽取的策略, 利用过期数据占比的方式控制删除频度
2-特点
 1-cpu性能占用设置有峰值，检测频度可自定义设置
 2-内存压力不是很大，长期占用内存的冷数据会被持续清理
3-总结: 周期性抽查存储空间(随机抽查，重点抽查) 
```

## 五 删除策略对比

### 5.1 定时删除

```
1-节约内存，无占用
2-不分时段占用cpu资源，频度高
3-拿时间换空间
```

### 5.2 惰性删除

```
1-内存占用严重
2-延时执行，cpu利用率高
3-拿空间换时间
```

### 5.3 定期删除

```
1-内存定期随机清理
2-每秒花费固定的cpu资源维护内存
3-随机抽查，重点抽查
```


## 六 思维导图

![javaweb-xmind-redis-hig-expi-datadel-2][1]



[1]:https://cdn.jsdelivr.net/gh/PGzxc/CDN/blog-java/javaweb-xmind-redis-hig-expi-datadel-2.png